<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>AI Concierge â€“ Premium Widget</title>

  <style>
    :root {
      --primary: #0066ff;
      --primary-dark: #003d99;
      --bg-dark: #0f172a;
      --bg-light: #e5e7eb;
    }

    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: radial-gradient(circle at top, #1d4ed8 0, #020617 55%);
      margin: 0;
      min-height: 100vh;
      color: white;
      transition: background 0.25s ease;
    }

    /* LIGHT THEME OVERRIDES */
    body.light-theme {
      background: linear-gradient(180deg, #e5e7eb, #ffffff);
      color: #020617;
    }

    body.light-theme #hotelCard {
      background: #ffffff;
      color: #020617;
      border-color: #cbd5f5;
    }

    body.light-theme #chatbox {
      background: #ffffff;
      border-color: #cbd5f5;
    }

    body.light-theme #messages {
      background: #f3f4f6;
    }

    body.light-theme .bot {
      background: #ffffff;
      color: #111827;
      border-color: #e5e7eb;
    }

    body.light-theme .user {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
    }

    body.light-theme #inputRow {
      background: #ffffff;
    }

    /* ÎœÎ¹ÎºÏÏŒ info card Ï€Î¬Î½Ï‰ Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬ (optional, ÎºÎ±Î¸Î±ÏÎ¬ Î³Î¹Î± Î¿Î¼Î¿ÏÏ†Î¹Î¬) */
    #hotelCard {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 14px 18px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      max-width: 260px;
      font-size: 13px;
    }

    #hotelCard h1 {
      margin: 0 0 4px;
      font-size: 17px;
    }

    #hotelCard small {
      color: #e5e7eb;
      opacity: 0.8;
    }

    /* Floating chat bubble */
    #chatBubble {
      width: 68px;
      height: 68px;
      background: radial-gradient(circle at 30% 0, #ffffff66 0, #ffffff00 40%),
                  linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: 50%;
      position: fixed;
      bottom: 25px;
      right: 25px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 32px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 1px solid #bfdbfe44;
      z-index: 15;
    }

    #chatBubble:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.6);
    }

    /* Chatbox */
    #chatbox {
      width: 390px;
      height: 580px;
      border-radius: 22px;
      background: rgba(15, 23, 42, 0.90);
      border: 1px solid rgba(148, 163, 184, 0.5);
      position: fixed;
      bottom: 110px;
      right: 25px;
      display: none; /* Î¾ÎµÎºÎ¹Î½Î¬ ÎºÏÏ…Ï†ÏŒ */
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 22px 60px rgba(0, 0, 0, 0.65);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      animation: fadeIn 0.3s ease-out;
      z-index: 20;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(16px) scale(0.96);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Header Î¼Îµ avatar / close / status / theme toggle */
    #chatHeader {
      padding: 10px 10px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      align-items: center;
      gap: 8px;
      color: #e5e7eb;
    }

    #avatar {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 0, #ffffffaa 0, #ffffff00 40%),
                  linear-gradient(135deg, #22c55e, #16a34a);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 19px;
      border: 1px solid #bbf7d0aa;
    }

    #headerText {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #headerText strong {
      font-size: 14px;
    }

    #headerText span {
      font-size: 11px;
      color: #9ca3af;
    }

    #statusDot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
      margin-right: 4px;
    }

    .headerBtn {
      cursor: pointer;
      font-size: 15px;
      color: #9ca3af;
      padding: 4px 7px;
      border-radius: 999px;
      transition: 0.15s;
      border: none;
      background: transparent;
    }

    .headerBtn:hover {
      background: rgba(148, 163, 184, 0.25);
      color: #e5e7eb;
    }

    /* Messages */
    #messages {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      background: linear-gradient(180deg, rgba(15,23,42,0.85), rgba(15,23,42,0.98));
      font-size: 14px;
    }

    #messages p {
      padding: 9px 13px;
      border-radius: 14px;
      max-width: 82%;
      margin-bottom: 10px;
      line-height: 1.35;
      animation: fadeInMsg 0.18s ease-out;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    @keyframes fadeInMsg {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .bot {
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #e5e7eb;
    }

    .user {
      background: linear-gradient(135deg, #60a5fa, #2563eb);
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }

    /* Typing indicator */
    #typing {
      font-size: 11px;
      color: #9ca3af;
      padding: 0 14px 6px;
      display: none;
      align-items: center;
      gap: 4px;
    }

    .typing-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #9ca3af;
      animation: bounce 1s infinite alternate;
    }

    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.15s; }
    .typing-dot:nth-child(3) { animation-delay: 0.3s; }

    @keyframes bounce {
      from { transform: translateY(0); opacity: 0.5; }
      to { transform: translateY(-3px); opacity: 1; }
    }

    /* Quick action buttons */
    #quickActions {
      display: flex;
      gap: 6px;
      padding: 8px;
      border-top: 1px solid rgba(148, 163, 184, 0.35);
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.95);
      overflow-x: auto;
    }

    .quickBtn {
      padding: 7px 11px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      cursor: pointer;
      font-size: 12px;
      white-space: nowrap;
      color: #e5e7eb;
      transition: 0.18s;
    }

    .quickBtn:hover {
      background: #2563eb;
      border-color: #60a5fa;
      color: white;
    }

    #inputRow {
      display: flex;
      border-top: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.96);
    }

    #msgInput {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      border: none;
      outline: none;
      background: transparent;
      color: #e5e7eb;
    }

    #msgInput::placeholder {
      color: #6b7280;
    }

    #sendBtn {
      padding: 0 18px;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 14px;
      border-radius: 999px;
      margin: 6px;
    }

    #sendBtn:hover {
      filter: brightness(1.05);
    }

    /* Restart button */
    #restartBtn {
      display: none;
      margin: 6px 12px 12px;
      width: calc(100% - 24px);
      padding: 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: transparent;
      color: #e5e7eb;
      font-size: 13px;
      cursor: pointer;
      transition: 0.18s;
    }

    #restartBtn:hover {
      background: #2563eb;
      border-color: #60a5fa;
      color: white;
    }

    body.light-theme #restartBtn {
      color: #111827;
      border-color: #cbd5f5;
    }

    body.light-theme #restartBtn:hover {
      background: #2563eb;
      color: white;
      border-color: #60a5fa;
    }
  </style>
</head>

<body>

  <!-- ÎœÎ¹ÎºÏÎ® ÎºÎ±ÏÏ„Î­Î»Î± Î¾ÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î¿Ï… -->
  <div id="hotelCard">
    <h1>Acropolis View Hotel</h1>
    <small>AI Concierge demo widget<br>Î‘Î¸Î®Î½Î±, ÎºÎ­Î½Ï„ÏÎ¿ â€“ Î´Î¯Ï€Î»Î± ÏƒÏ„Î·Î½ Î‘ÎºÏÏŒÏ€Î¿Î»Î·</small>
  </div>

  <!-- Floating bubble -->
  <div id="chatBubble">ğŸ’¬</div>

  <!-- Chat window -->
  <div id="chatbox">
    <div id="chatHeader">
      <div id="avatar">ğŸ¤µ</div>
      <div id="headerText">
        <strong>AI Concierge</strong>
        <span><span id="statusDot"></span>Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿Ï‚ Î³Î¹Î± Î²Î¿Î®Î¸ÎµÎ¹Î±</span>
      </div>
      <button id="themeToggle" class="headerBtn">â˜¾</button>
      <button id="closeBtn" class="headerBtn">Ã—</button>
    </div>

    <div id="messages"></div>
    <div id="typing">
      <span class="typing-dot"></span>
      <span class="typing-dot"></span>
      <span class="typing-dot"></span>
      ÎŸ concierge Ï€Î»Î·ÎºÏ„ÏÎ¿Î»Î¿Î³ÎµÎ¯â€¦
    </div>

    <!-- Quick replies -->
    <div id="quickActions">
      <div class="quickBtn" data-msg="Î Î¿Î¹ÎµÏ‚ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ ÏÏÎµÏ‚ check-in ÎºÎ±Î¹ check-out;">
        ğŸ•’ Check-in / Check-out
      </div>

      <div class="quickBtn" data-msg="Î˜Î± Î®Î¸ÎµÎ»Î± Î½Î± ÎºÎ±Î½Î¿Î½Î¯ÏƒÏ‰ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬ Î¼Îµ Ï„Î±Î¾Î¯ Î±Ï€ÏŒ Î® Ï€ÏÎ¿Ï‚ Ï„Î¿ Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î¿.">
        ğŸš• ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ Î±ÎµÏÎ¿Î´ÏÎ¿Î¼Î¯Î¿Ï…
      </div>

      <div class="quickBtn" data-msg="Î¤Î¹ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Ï€ÏÏ‰Î¹Î½Î¿Ï Î­Ï‡ÎµÏ„Îµ ÎºÎ±Î¹ Ï€Î¿Î¹Î¿ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Ï‰ÏÎ¬ÏÎ¹Î¿;">
        ğŸ½ Î ÏÏ‰Î¹Î½ÏŒ & Ï‰ÏÎ¬ÏÎ¹Î¿
      </div>

      <div class="quickBtn" data-msg="Î¤Î¹ Ï€ÏÎ¿Ï„ÎµÎ¯Î½ÎµÏ„Îµ Î½Î± ÎºÎ¬Î½Ï‰ ÏƒÏ„Î·Î½ Î‘Î¸Î®Î½Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± Ï„Î·Ï‚ Î´Î¹Î±Î¼Î¿Î½Î®Ï‚ Î¼Î¿Ï…;">
        ğŸ—º Î‘Î¾Î¹Î¿Î¸Î­Î±Ï„Î± Î‘Î¸Î®Î½Î±Ï‚
      </div>

      <div class="quickBtn" data-msg="Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î±Î½Î±Î²Î¬Î¸Î¼Î¹ÏƒÎ·Ï‚ Ï„Î¿Ï… Î´Ï‰Î¼Î±Ï„Î¯Î¿Ï… Î¼Î¿Ï…;">
        ğŸ¨ Upgrade Î´Ï‰Î¼Î±Ï„Î¯Î¿Ï…
      </div>
    </div>

    <div id="inputRow">
      <input id="msgInput" placeholder="Î“ÏÎ¬ÏˆÏ„Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î¬ ÏƒÎ±Ï‚ ÎµÎ´Ï..." />
      <button id="sendBtn">Send</button>
    </div>

    <button id="restartBtn">ÎÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Î½Î­Î± ÏƒÏ…Î½Î¿Î¼Î¹Î»Î¯Î±</button>
  </div>

  <script>
    const chatBubble = document.getElementById("chatBubble");
    const chatbox = document.getElementById("chatbox");
    const closeBtn = document.getElementById("closeBtn");
    const themeToggle = document.getElementById("themeToggle");
    const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("msgInput");
    const sendBtn = document.getElementById("sendBtn");
    const quickButtons = document.querySelectorAll(".quickBtn");
    const typingEl = document.getElementById("typing");
    const restartBtn = document.getElementById("restartBtn");

    let customerName = null;
    let isLightTheme = false;

    function toggleChat(openForce = null) {
      if (openForce === true) {
        chatbox.style.display = "flex";
        return;
      }
      if (openForce === false) {
        chatbox.style.display = "none";
        return;
      }
      chatbox.style.display = chatbox.style.display === "flex" ? "none" : "flex";
    }

    chatBubble.addEventListener("click", () => toggleChat());
    closeBtn.addEventListener("click", () => toggleChat(false));

    themeToggle.addEventListener("click", () => {
      isLightTheme = !isLightTheme;
      document.body.classList.toggle("light-theme", isLightTheme);
      themeToggle.textContent = isLightTheme ? "â˜€" : "â˜¾";
    });

    function getGreeting() {
      const hour = new Date().getHours();
      if (hour < 12) return "ÎšÎ±Î»Î·Î¼Î­ÏÎ±";
      if (hour < 18) return "ÎšÎ±Î»ÏŒ Î±Ï€ÏŒÎ³ÎµÏ…Î¼Î±";
      return "ÎšÎ±Î»ÏŒ Î²ÏÎ¬Î´Ï…";
    }

    function detectNameFromText(text) {
      const lower = text.toLowerCase();

      // Î¼Îµ Î»Î­Î½Îµ ÎÎ¯ÎºÎ¿
      let m = lower.match(/Î¼Îµ Î»[ÎµÎ­]Î½Îµ\s+([^\s,.!]+)/i);
      if (m && m[1]) {
        customerName = m[1].charAt(0).toUpperCase() + m[1].slice(1);
        return;
      }

      // ÎµÎ¯Î¼Î±Î¹ Î¿/Î· ÎÎ¯ÎºÎ¿Ï‚/ÎœÎ±ÏÎ¯Î±
      m = lower.match(/ÎµÎ¯Î¼Î±Î¹\s+(Î¿|Î·)\s+([^\s,.!]+)/i);
      if (m && m[2]) {
        customerName = m[2].charAt(0).toUpperCase() + m[2].slice(1);
        return;
      }

      // Î»Î­Î³Î¿Î¼Î±Î¹ ÎÎ¯ÎºÎ¿Ï‚
      m = lower.match(/Î»Î­Î³Î¿Î¼Î±Î¹\s+([^\s,.!]+)/i);
      if (m && m[1]) {
        customerName = m[1].charAt(0).toUpperCase() + m[1].slice(1);
      }
    }

    function addMessage(text, sender) {
      const p = document.createElement("p");

      let finalText = text;
      if (sender === "bot" && customerName && !text.includes("Î£Î±Ï‚ ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Ï€Î¿Î»Ï Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÏŒÎ½Î¿ ÏƒÎ±Ï‚")) {
        finalText = `Î‘Î³Î±Ï€Î·Ï„Î­/Î® ${customerName}, ${text}`;
      }

      p.textContent = finalText;
      p.classList.add(sender);
      messagesDiv.appendChild(p);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function setTyping(on) {
      typingEl.style.display = on ? "flex" : "none";
    }

    function playMessageSound() {
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      if (!AudioCtx) return;
      const ctx = new AudioCtx();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "sine";
      osc.frequency.value = 880;
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start();
      gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.15);
      osc.stop(ctx.currentTime + 0.15);
    }

    async function sendMessage(textOverride = null) {
      const text = textOverride || input.value.trim();
      if (!text) return;

      detectNameFromText(text);
      addMessage(text, "user");
      input.value = "";

      setTyping(true);

      try {
        const res = await fetch("http://localhost:3000/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text }),
        });

        const data = await res.json();
        addMessage(data.reply, "bot");
        playMessageSound();

        // Auto-close & restart logic ÏŒÏ„Î±Î½ Î­Ï‡ÎµÎ¹ ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Î®ÏÎ¹Î¿/exit Î¼Î®Î½Ï…Î¼Î±
        if (data.reply.startsWith("Î£Î±Ï‚ ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Ï€Î¿Î»Ï Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÏŒÎ½Î¿ ÏƒÎ±Ï‚")) {
          restartBtn.style.display = "block";
          setTimeout(() => {
            toggleChat(false);
          }, 2500);
        }
      } catch (err) {
        console.error(err);
        addMessage("Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Ï„ÎµÏ‡Î½Î¹ÎºÏŒ Ï€ÏÏŒÎ²Î»Î·Î¼Î± Î¼Îµ Ï„Î¿Î½ server. Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.", "bot");
      } finally {
        setTyping(false);
      }
    }

    sendBtn.addEventListener("click", () => sendMessage());
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    // Quick reply buttons Î¼Îµ data-msg
    quickButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const message = btn.dataset.msg || btn.textContent;
        sendMessage(message);
      });
    });

    restartBtn.addEventListener("click", () => {
      // reset state
      messagesDiv.innerHTML = "";
      customerName = null;
      restartBtn.style.display = "none";
      addWelcomeMessages();
      toggleChat(true);
    });

    function addWelcomeMessages() {
      const greeting = getGreeting();
      addMessage(
        `${greeting}! ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ ÏƒÏ„Î¿ Acropolis View Hotel. Î•Î¯Î¼Î±Î¹ Î¿ ÏˆÎ·Ï†Î¹Î±ÎºÏŒÏ‚ concierge ÏƒÎ±Ï‚ ÎºÎ±Î¹ Ï‡Î±Î¯ÏÎ¿Î¼Î±Î¹ Ï€Î¿Ï… ÎµÎ¯ÏƒÏ„Îµ Î¼Î±Î¶Î¯ Î¼Î±Ï‚.`,
        "bot"
      );
      addMessage(
        "ÎœÏ€Î¿ÏÏ Î½Î± ÏƒÎ±Ï‚ Î²Î¿Î·Î¸Î®ÏƒÏ‰ Î¼Îµ ÏÏÎµÏ‚ check-in / check-out, Î¼ÎµÏ„Î±Ï†Î¿ÏÎ­Ï‚ Î±ÎµÏÎ¿Î´ÏÎ¿Î¼Î¯Î¿Ï…, Ï€ÏÏ‰Î¹Î½ÏŒ Î® Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï„Î·Î½ Î‘Î¸Î®Î½Î±. Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¼Î¯Î± Î±Ï€ÏŒ Ï„Î¹Ï‚ ÏƒÏÎ½Ï„Î¿Î¼ÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Î® Î³ÏÎ¬ÏˆÏ„Îµ ÎµÎ»ÎµÏÎ¸ÎµÏÎ± Ï„Î·Î½ ÎµÏÏÏ„Î·ÏƒÎ® ÏƒÎ±Ï‚.",
        "bot"
      );
    }

    // Î‘ÏÏ‡Î¹ÎºÏŒ welcome + Î±Î½Î¿Î¯Î³ÎµÎ¹ chat Ï„Î·Î½ 1Î· Ï†Î¿ÏÎ¬
    addWelcomeMessages();
    toggleChat(true);
  </script>

</body>
</html>
